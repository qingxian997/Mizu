<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steam - è°·æ­Œé£æ ¼ (ä¸­æ–‡ç‰ˆ)</title>
    
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        :root {
            /* é»˜è®¤ä¸»é¢˜è‰² (Steam Blue) */
            --primary-color: #3b82f6; 
            --primary-rgb: 59, 130, 246;
            --primary-light: rgba(59, 130, 246, 0.1);
            --primary-hover: #2563eb;
            
            /* é»˜è®¤ç»ç’ƒå‚æ•° */
            --glass-bg: rgba(255, 255, 255, 0.75);
            --glass-blur: 16px;
            --glass-border: rgba(255, 255, 255, 0.6);
            --sidebar-bg: rgba(255, 255, 255, 0.6);
            --text-main: #1e293b;
            --text-muted: #64748b;
        }

        body {
            font-family: 'Noto Sans SC', 'Roboto', sans-serif;
            transition: background-image 0.5s ease-in-out;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: #f8fafc; /* ç»™äºˆä¸€ä¸ªææ·¡çš„åº•è‰²ï¼Œé˜²æ­¢å…‰æ™•åŠ è½½å‰å…¨ç™½ */
        }

        /* åŠ¨æ€ä¸»é¢˜è‰²å·¥å…·ç±» */
        .theme-text { color: var(--primary-color) !important; }
        .theme-bg { background-color: var(--primary-color) !important; }
        .theme-bg-light { background-color: var(--primary-light) !important; }
        .theme-border { border-color: var(--primary-color) !important; }
        .theme-hover:hover { background-color: var(--primary-hover) !important; }
        .theme-ring:focus { --tw-ring-color: var(--primary-color) !important; }
        
        /* --------------------------------------------------------------------------
           æ ¸å¿ƒç»ç’ƒæ ·å¼ (å“åº”è‡ªå®šä¹‰èƒŒæ™¯)
           -------------------------------------------------------------------------- */
        
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }

        .acrylic-sidebar-bg {
            background: var(--sidebar-bg);
            backdrop-filter: blur(var(--glass-blur)); /* ä½¿ç”¨å˜é‡åŒæ­¥æ¨¡ç³Šåº¦ */
            -webkit-backdrop-filter: blur(var(--glass-blur));
            border-right: 1px solid var(--glass-border);
            transition: all 0.3s ease;
        }

        /* å½“è®¾ç½®äº†è‡ªå®šä¹‰èƒŒæ™¯æ—¶ (High Transparency Mode) */
        body.has-custom-bg {
            background-color: transparent !important; /* æœ‰èƒŒæ™¯å›¾æ—¶ï¼Œåº•è‰²é€æ˜ */
            text-shadow: 0 1px 2px rgba(0,0,0,0.1); /* å¢å¼ºæ–‡å­—å¯è¯»æ€§ */
            --glass-bg: rgba(255, 255, 255, 0.15); /* æé«˜é€æ˜åº¦ */
            --glass-border: rgba(255, 255, 255, 0.2);
            --sidebar-bg: rgba(255, 255, 255, 0.1);
        }

        body.has-custom-bg .glass-panel {
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        body.has-custom-bg header, 
        body.has-custom-bg nav {
            background: rgba(255, 255, 255, 0.1) !important;
            border-bottom-color: rgba(255, 255, 255, 0.1) !important;
            backdrop-filter: blur(var(--glass-blur)) !important;
            -webkit-backdrop-filter: blur(var(--glass-blur)) !important;
        }

        body.has-custom-bg .list-row {
            background-color: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(var(--glass-blur));
            -webkit-backdrop-filter: blur(var(--glass-blur));
        }
        body.has-custom-bg .list-row:hover {
            background-color: rgba(255, 255, 255, 0.25);
        }

        /* -------------------------------------------------------------------------- */

        /* ä¾§è¾¹æ æ ·å¼å¾®è°ƒ */
        .sidebar-left-style { border-radius: 0 1.5rem 1.5rem 0; border-left: none; }
        .sidebar-inner-style { border-radius: 1.5rem; }
        .sidebar-right-style { border-radius: 1.5rem; }

        /* åŠ¨ç”»ä¸äº¤äº’ */
        @keyframes shine {
            from { transform: translateX(-200%) skewX(-12deg); }
            to { transform: translateX(200%) skewX(-12deg); }
        }
        .animate-shine { animation: shine 1.5s infinite linear; }

        .sidebar-item.active-item {
            background-color: var(--primary-light) !important;
            color: var(--primary-color) !important;
            font-weight: 600;
        }
        .sidebar-item.active-item i { transform: scale(1.1); }

        .toggle-checkbox:checked { right: 0; border-color: var(--primary-color); }
        .toggle-checkbox:checked + .toggle-label { background-color: var(--primary-color); }

        .tab-btn.active-tab { color: var(--primary-color); }
        .tab-btn.active-tab span { background-color: var(--primary-color); box-shadow: 0 -2px 6px rgba(var(--primary-rgb), 0.4); }

        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(0,0,0,0.1); border-radius: 20px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background-color: rgba(0,0,0,0.2); }

        .fade-hidden { opacity: 0; pointer-events: none; transition: opacity 0.2s ease-out; }
        .fade-visible { opacity: 1; pointer-events: auto; transition: opacity 0.2s ease-in; }
        
        /* èŒƒå›´æ»‘å—æ ·å¼ä¼˜åŒ– */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }
        
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: rgba(0,0,0,0.1);
            border-radius: 2px;
        }
    </style>
</head>
<body class="text-slate-800 selection:bg-blue-100 flex flex-col h-screen overflow-hidden relative" id="app-body">
    
    <!-- é»˜è®¤èƒŒæ™¯å…‰æ™• (æœ‰è‡ªå®šä¹‰å£çº¸æ—¶éšè—) -->
    <!-- z-index 0: æ”¾åœ¨æœ€åº•å±‚ï¼Œä½†å¿…é¡»åœ¨ overlay ä¹‹ä¸‹ -->
    <div id="default-bg-blobs" class="fixed inset-0 w-full h-full -z-20 pointer-events-none">
        <div class="absolute top-0 left-0 w-full h-full bg-gradient-to-br from-blue-50 via-white to-purple-50"></div>
        <div class="absolute top-[-20%] left-[-10%] w-[50%] h-[50%] rounded-full blur-[100px] transition-colors duration-700 opacity-80" style="background-color: rgba(var(--primary-rgb), 0.3);"></div>
        <div class="absolute bottom-[-20%] right-[-10%] w-[50%] h-[50%] rounded-full blur-[100px] transition-colors duration-700 opacity-80" style="background-color: rgba(var(--primary-rgb), 0.2);"></div>
    </div>

    <!-- èƒŒæ™¯é®ç½©å±‚ (Background Overlay) -->
    <!-- z-0 ç¡®ä¿åœ¨èƒŒæ™¯ä¹‹ä¸Šï¼Œä½†åœ¨å†…å®¹(z-10+)ä¹‹ä¸‹ -->
    <div id="bg-overlay" class="fixed inset-0 z-0 pointer-events-none transition-colors duration-300" style="background-color: rgba(0, 0, 0, 0);"></div>

    <!-- 1. Header -->
    <header class="flex items-center justify-between px-6 py-3 bg-white/70 backdrop-blur-xl sticky top-0 z-50 shadow-sm border-b border-white/60">
        <div class="flex items-center gap-4 w-64">
            <div id="header-logo" class="text-2xl font-bold tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-slate-700 to-slate-500 cursor-pointer hover:opacity-80 transition-opacity" style="background-image: linear-gradient(to right, var(--primary-color), var(--primary-hover));">
                Steam
            </div>
        </div>

        <div class="flex-1 max-w-2xl mx-4">
            <div class="relative group">
                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                    <i data-lucide="search" class="text-slate-400 w-5 h-5 group-focus-within:theme-text transition-colors"></i>
                </div>
                <input id="global-search" type="text" placeholder="æœç´¢æ¸¸æˆ..." class="w-full pl-12 pr-4 py-3 bg-white/60 border border-white/40 rounded-full shadow-sm text-slate-700 placeholder-slate-400 focus:outline-none focus:ring-2 focus:bg-white/90 focus:shadow-md transition-all duration-300 theme-ring"/>
            </div>
        </div>

        <div class="flex items-center gap-3 w-64 justify-end">
            <button id="view-toggle-btn" class="p-2 rounded-full hover:bg-black/5 text-slate-600 transition-colors fade-visible" title="åˆ‡æ¢è§†å›¾">
                <i id="view-icon" data-lucide="grid" class="w-6 h-6"></i>
            </button>
            <div id="user-avatar-btn" class="w-9 h-9 rounded-full text-white flex items-center justify-center font-medium shadow-md hover:shadow-lg transition-all cursor-pointer theme-bg theme-hover" title="å‰å¾€è®¾ç½®">
                G
            </div>
        </div>
    </header>

    <!-- 2. Nav -->
    <nav class="flex px-8 border-b border-white/50 gap-8 text-sm font-medium text-slate-500 bg-white/50 backdrop-blur-md sticky top-[72px] z-40" id="tabs-container">
        <button class="tab-btn py-4 px-2 relative transition-colors duration-200 hover:text-slate-800" data-tab="Home">é¦–é¡µ</button>
        <button class="tab-btn py-4 px-2 relative transition-colors duration-200 active-tab" data-tab="Library">åº“</button>
        <button class="tab-btn py-4 px-2 relative transition-colors duration-200 hover:text-slate-800" data-tab="Settings">è®¾ç½®</button>
        <button class="tab-btn py-4 px-2 relative transition-colors duration-200 hover:text-slate-800" data-tab="Community">ç¤¾åŒº</button>
    </nav>

    <div class="flex flex-1 overflow-hidden relative">
        <!-- 3. Sidebar (Library) -->
        <aside id="main-sidebar" class="w-64 flex flex-col pt-6 pb-4 overflow-y-auto custom-scrollbar pl-4 hidden md:flex acrylic-sidebar-bg sidebar-left-style z-30 mt-2 mb-2 ml-0 shadow-lg">
            <div class="px-4 mb-2 text-xs font-bold text-slate-500 uppercase tracking-wider">æˆ‘çš„æ¸¸æˆåº“</div>
            
            <div id="sidebar-filters">
                <div class="sidebar-item flex items-center gap-4 px-4 py-3 mx-2 rounded-r-full cursor-pointer transition-all duration-200 group text-slate-600 hover:bg-black/5" data-filter="favorites">
                    <div class="transition-transform duration-200 group-hover:scale-110"><i data-lucide="star" class="w-5 h-5"></i></div>
                    <span class="font-medium text-sm truncate">æ”¶è—</span>
                </div>
                <div class="sidebar-item flex items-center gap-4 px-4 py-3 mx-2 rounded-r-full cursor-pointer transition-all duration-200 group text-slate-600 hover:bg-black/5" data-filter="recent">
                    <div class="transition-transform duration-200 group-hover:scale-110"><i data-lucide="clock" class="w-5 h-5"></i></div>
                    <span class="font-medium text-sm truncate">æœ€è¿‘æ¸¸ç©</span>
                </div>
                <div class="sidebar-item active-item flex items-center gap-4 px-4 py-3 mx-2 rounded-r-full cursor-pointer transition-all duration-200 group" data-filter="all">
                    <div class="transition-transform duration-200 scale-110"><i data-lucide="layout-grid" class="w-5 h-5"></i></div>
                    <span class="font-medium text-sm truncate">æ‰€æœ‰æ¸¸æˆ</span>
                </div>
            </div>
            
            <div id="sidebar-ai-section" class="mx-4 mt-4 mb-2" style="display: block;">
                <button id="ai-pick-btn" class="w-full flex items-center gap-3 px-4 py-3 text-white rounded-xl shadow-lg hover:shadow-xl hover:scale-105 transition-all duration-300 group border border-white/20 theme-bg theme-hover">
                    <i data-lucide="sparkles" class="w-5 h-5 animate-pulse"></i>
                    <span class="font-bold text-sm">AI æ™ºèƒ½æ¨è</span>
                </button>
            </div>
            
            <div class="my-4 border-t border-black/5 mx-4"></div>
            <div class="px-4 mb-2 text-xs font-bold text-slate-500 uppercase tracking-wider">å·²å®‰è£…</div>
            <div id="sidebar-games" class="space-y-1"></div>
        </aside>

        <!-- 4. Main Content -->
        <main class="flex-1 overflow-y-auto p-8 relative custom-scrollbar z-10" id="main-scroll-area">
            
            <!-- VIEW: Library -->
            <div id="view-Library" class="view-section grid gap-8 pb-20" style="grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));"></div>

            <!-- VIEW: Game Detail -->
            <div id="view-GameDetail" class="view-section hidden w-full max-w-7xl mx-auto pb-20">
                <button id="back-to-library" class="mb-6 flex items-center gap-2 text-slate-500 hover:theme-text transition-colors bg-white/50 px-4 py-2 rounded-full backdrop-blur-sm shadow-sm hover:shadow">
                    <i data-lucide="arrow-left" class="w-5 h-5"></i>
                    <span class="font-medium">è¿”å›åº“</span>
                </button>
                <div class="relative w-full h-[500px] rounded-3xl overflow-hidden shadow-2xl mb-8 group">
                    <div id="detail-hero-bg" class="absolute inset-0 bg-gradient-to-br from-slate-800 to-black transition-colors duration-700"></div>
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent">
                         <div class="absolute bottom-0 left-0 p-10 w-full">
                            <div class="flex items-end justify-between">
                                <div>
                                    <div id="detail-logo" class="text-6xl font-black text-white mb-4 drop-shadow-lg tracking-tight font-serif">GAME TITLE</div>
                                    <div class="flex items-center gap-6 text-slate-200 mb-8">
                                        <div class="flex items-center gap-2 bg-white/10 px-3 py-1 rounded-full backdrop-blur-sm border border-white/10"><i data-lucide="clock" class="w-4 h-4"></i><span id="detail-hours">--</span></div>
                                        <div class="flex items-center gap-2 bg-white/10 px-3 py-1 rounded-full backdrop-blur-sm border border-white/10"><i data-lucide="calendar" class="w-4 h-4"></i><span id="detail-last-played">--</span></div>
                                    </div>
                                    <div class="flex gap-4">
                                        <button class="px-10 py-4 bg-white text-slate-900 rounded-2xl font-bold text-lg hover:bg-blue-50 hover:scale-105 transition-all shadow-lg flex items-center gap-3">
                                            <i data-lucide="play" class="fill-current w-5 h-5"></i> å¼€å§‹æ¸¸æˆ
                                        </button>
                                        <button id="detail-ai-insight-btn" class="px-6 py-4 bg-white/10 backdrop-blur-md text-white border border-white/20 rounded-2xl font-bold text-lg hover:bg-white/20 transition-all flex items-center gap-3">
                                            <i data-lucide="sparkles" class="w-5 h-5"></i> AI æˆ˜æœ¯åˆ†æ
                                        </button>
                                        <button id="detail-fav-btn" class="p-4 bg-white/10 backdrop-blur-md text-white border border-white/20 rounded-2xl hover:bg-white/20 transition-all" onclick="window.toggleDetailFavorite()">
                                            <i data-lucide="star" class="w-6 h-6"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                         </div>
                    </div>
                </div>
                <!-- Detail Info -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 space-y-8">
                        <div class="glass-panel p-6">
                            <h3 class="font-bold text-xl mb-4">æœ€è¿‘æˆå°±</h3>
                            <div class="flex gap-4 overflow-x-auto pb-2">
                                <div class="w-20 h-20 bg-slate-200/50 rounded-xl flex-shrink-0"></div>
                                <div class="w-20 h-20 bg-amber-100/50 rounded-xl flex-shrink-0 border-2 theme-border"></div>
                                <div class="w-20 h-20 bg-slate-200/50 rounded-xl flex-shrink-0"></div>
                            </div>
                        </div>
                    </div>
                    <div class="space-y-8">
                         <div class="glass-panel p-6">
                            <h3 class="font-bold text-xl mb-4">æ›´æ–°æ–°é—»</h3>
                            <div class="space-y-4">
                                <div class="group cursor-pointer"><div class="text-sm text-slate-500 mb-1">ä»Šå¤©</div><div class="font-medium hover:theme-text transition-colors">è¡¥ä¸è¯´æ˜ v1.05</div></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: Settings -->
            <div id="view-Settings" class="view-section hidden h-full max-w-6xl mx-auto flex gap-8 pb-20">
                <!-- Settings Sidebar -->
                <div class="w-64 flex-shrink-0 acrylic-sidebar-bg sidebar-inner-style p-4 flex flex-col gap-2 h-fit">
                    <h2 class="px-4 py-3 text-xl font-bold mb-2 text-slate-800 border-b border-black/5">è®¾ç½®</h2>
                    <button class="settings-nav-btn text-left px-4 py-3 rounded-xl theme-bg-light theme-text font-semibold flex items-center gap-3 transition-colors" data-target="settings-account"><i data-lucide="user" class="w-5 h-5"></i> è´¦æˆ·</button>
                    <button class="settings-nav-btn text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-black/5 flex items-center gap-3 transition-colors" data-target="settings-interface"><i data-lucide="layout" class="w-5 h-5"></i> ç•Œé¢ & ä¸»é¢˜</button>
                    <button class="settings-nav-btn text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-black/5 flex items-center gap-3 transition-colors" data-target="settings-ai"><i data-lucide="sparkles" class="w-5 h-5"></i> AI æ™ºèƒ½</button>
                    <button class="settings-nav-btn text-left px-4 py-3 rounded-xl text-slate-600 hover:bg-black/5 flex items-center gap-3 transition-colors" data-target="settings-storage"><i data-lucide="hard-drive" class="w-5 h-5"></i> å­˜å‚¨ç©ºé—´</button>
                </div>

                <!-- Settings Content -->
                <div class="flex-1 glass-panel p-8 h-fit min-h-[500px]">
                    <!-- Account -->
                    <div id="settings-account" class="settings-content-panel space-y-6">
                        <h3 class="text-2xl font-bold mb-6">è´¦æˆ·è¯¦æƒ…</h3>
                        <div class="flex items-center gap-6 mb-8 p-6 bg-white/40 rounded-2xl border border-white/50">
                            <div class="w-20 h-20 rounded-full text-white flex items-center justify-center text-3xl font-bold shadow-lg ring-4 ring-white/50 theme-bg">G</div>
                            <div>
                                <h3 class="text-2xl font-bold">Gamer_001</h3>
                                <p class="text-slate-500 flex items-center gap-2"><span class="w-2 h-2 rounded-full bg-green-500"></span> åœ¨çº¿</p>
                            </div>
                        </div>
                    </div>

                    <!-- Interface -->
                    <div id="settings-interface" class="settings-content-panel hidden space-y-6">
                        <h3 class="text-2xl font-bold mb-6">ç•Œé¢ä¸ä¸ªæ€§åŒ–</h3>
                        
                        <!-- Blur Control -->
                        <div class="p-5 bg-white/40 rounded-2xl border border-white/50 space-y-4">
                            <div class="flex items-center justify-between">
                                <div><h4 class="font-bold text-slate-700">ç»ç’ƒæ¨¡ç³Šåº¦</h4><p class="text-xs text-slate-500">è°ƒæ•´ç•Œé¢ç£¨ç ‚æ„Ÿï¼Œæ•°å€¼è¶Šä½è¶Šé€šé€ã€‚</p></div>
                                <div class="flex items-center gap-3 w-1/3">
                                    <input type="range" id="blur-slider" min="0" max="50" value="16" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                    <span id="blur-value" class="text-sm font-bold text-slate-600 w-8 text-center">16</span>
                                </div>
                            </div>
                        </div>

                        <!-- Overlay Control -->
                         <div class="p-5 bg-white/40 rounded-2xl border border-white/50 space-y-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="font-bold text-slate-700">èƒŒæ™¯é®ç½©æµ“åº¦</h4>
                                    <p class="text-xs text-slate-500">åŠ æ·±èƒŒæ™¯é˜´å½±ï¼Œè®©æ–‡å­—åœ¨äº®è‰²å£çº¸ä¸Šæ›´æ¸…æ™°ã€‚</p>
                                </div>
                                <div class="flex items-center gap-3 w-1/3">
                                    <input type="range" id="overlay-slider" min="0" max="90" value="0" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                                    <span id="overlay-value" class="text-sm font-bold text-slate-600 w-8 text-center">0%</span>
                                </div>
                            </div>
                        </div>

                        <div class="p-5 bg-white/40 rounded-2xl border border-white/50 space-y-4">
                            <div class="flex items-center justify-between">
                                <div><h4 class="font-bold text-slate-700">ä¸»é¢˜è‰²è°ƒ</h4><p class="text-xs text-slate-500">ä¸Šä¼ å£çº¸æ—¶è‡ªåŠ¨æå–ï¼Œæˆ–æ‰‹åŠ¨è®¾ç½®ã€‚</p></div>
                                <div class="flex items-center gap-3">
                                    <input type="color" id="theme-color-picker" class="w-10 h-10 rounded-full cursor-pointer border-2 border-white shadow-sm" value="#3b82f6" title="é€‰æ‹©ä¸»é¢˜è‰²">
                                    <label class="flex items-center gap-2 text-sm text-slate-600 cursor-pointer"><input type="checkbox" id="auto-theme-color" class="rounded theme-text focus:ring-blue-500" checked> è‡ªåŠ¨åŒ¹é…</label>
                                </div>
                            </div>
                        </div>

                        <!-- NEW: Preset Gallery -->
                        <div class="p-5 bg-white/40 rounded-2xl border border-white/50 space-y-4">
                            <h4 class="font-bold text-slate-700">ç²¾é€‰å£çº¸åº“</h4>
                            <div id="preset-bg-container" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                <!-- JS will populate this -->
                            </div>
                        </div>

                        <div class="p-5 bg-white/40 rounded-2xl border border-white/50 space-y-4">
                            <h4 class="font-bold text-slate-700">è‡ªå®šä¹‰èƒŒæ™¯</h4>
                            <div class="flex items-center gap-4">
                                <label class="flex-1 cursor-pointer">
                                    <span class="sr-only">é€‰æ‹©å›¾ç‰‡</span>
                                    <input type="file" id="bg-upload" accept="image/*" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 theme-text theme-bg-light"/>
                                </label>
                                <button id="clear-bg-btn" class="px-4 py-2 text-sm text-red-600 bg-red-50 hover:bg-red-100 rounded-lg transition-colors">æ¢å¤é»˜è®¤</button>
                            </div>
                        </div>
                    </div>

                    <!-- AI -->
                    <div id="settings-ai" class="settings-content-panel hidden space-y-6">
                        <h3 class="text-2xl font-bold mb-6 flex items-center gap-3 theme-text"><i data-lucide="sparkles" class="w-6 h-6"></i> AI æ™ºèƒ½é…ç½®</h3>
                        <div class="flex items-center justify-between p-5 bg-indigo-50/50 rounded-2xl border border-indigo-100">
                            <div><div class="font-bold text-slate-800">å¯ç”¨ AI è¾…åŠ©</div><div class="text-sm text-slate-500">æ˜¾ç¤ºæ¨èä¸åˆ†æå…¥å£</div></div>
                            <div class="relative inline-block w-12 align-middle select-none"><input type="checkbox" id="ai-master-switch" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-slate-300"/><label for="ai-master-switch" class="toggle-label block overflow-hidden h-6 rounded-full bg-slate-300 cursor-pointer"></label></div>
                        </div>
                        <div class="space-y-4">
                            <label class="block font-medium text-slate-700">AI æœåŠ¡å•†</label>
                            <div class="grid grid-cols-3 gap-4">
                                <div class="provider-option p-4 rounded-xl border border-slate-200 bg-white/50 text-center cursor-pointer relative" data-provider="gemini"><div class="font-bold">Gemini</div></div>
                                <div class="provider-option p-4 rounded-xl border border-slate-200 bg-white/50 text-center cursor-pointer relative" data-provider="openai"><div class="font-bold">OpenAI</div></div>
                                <div class="provider-option p-4 rounded-xl border border-slate-200 bg-white/50 text-center cursor-pointer relative" data-provider="local"><div class="font-bold">Local</div></div>
                            </div>
                        </div>
                        <div class="space-y-4 p-5 bg-white/40 rounded-2xl border border-white/50">
                            <div id="ai-base-url-group" class="hidden"><label class="block text-sm font-medium text-slate-700 mb-1">Base URL</label><input type="text" id="ai-base-url" class="w-full px-3 py-2 rounded-lg border border-slate-300 text-sm theme-ring"></div>
                            <div><label class="block text-sm font-medium text-slate-700 mb-1">æ¨¡å‹åç§°</label><input type="text" id="ai-model-name" class="w-full px-3 py-2 rounded-lg border border-slate-300 text-sm theme-ring"></div>
                            <div id="ai-api-key-group"><label class="block text-sm font-medium text-slate-700 mb-1">API Key</label><input type="password" id="ai-api-key" placeholder="sk-..." class="w-full px-3 py-2 rounded-lg border border-slate-300 text-sm theme-ring"></div>
                            <button id="save-ai-config-btn" class="w-full px-4 py-2 text-white text-sm rounded-lg transition-colors theme-bg theme-hover">ä¿å­˜é…ç½®</button>
                        </div>
                    </div>
                    
                    <!-- Storage (Placeholder) -->
                    <div id="settings-storage" class="settings-content-panel hidden space-y-6">
                        <h3 class="text-2xl font-bold mb-6">å­˜å‚¨ç®¡ç†</h3>
                        <div class="h-4 bg-slate-200 rounded-full overflow-hidden flex mb-2">
                            <div class="w-[60%] h-full theme-bg"></div>
                            <div class="w-[20%] bg-gray-400 h-full"></div>
                        </div>
                        <div class="flex justify-between text-sm text-slate-500"><span>å·²ç”¨: 600GB</span><span>å‰©ä½™: 400GB</span></div>
                    </div>
                </div>
            </div>

            <!-- VIEW: Community -->
            <div id="view-Community" class="view-section hidden h-full max-w-7xl mx-auto flex gap-6 pb-20">
                <div class="flex-1 space-y-6 overflow-y-auto custom-scrollbar pr-2">
                    <h2 class="text-xl font-bold px-2">å¥½å‹åŠ¨æ€</h2>
                    <div class="glass-panel p-6">
                        <div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 rounded-full bg-green-500 flex items-center justify-center text-white font-bold text-sm shadow-md">A</div><div><div class="font-bold text-sm">Alex_Shooter</div><div class="text-xs text-slate-500">2å°æ—¶å‰ â€¢ ç©ã€ŠApex è‹±é›„ã€‹</div></div></div>
                        <p class="text-slate-700 mb-4">è¿™æŠŠç»äº†ï¼æœ€åé‚£ä¸ªåœˆç®€ç›´æ˜¯æ··ä¹±ï¼Œä½†æˆ‘è¿˜æ˜¯æ‹¿åˆ°äº†å† å†›ï¼ğŸ†</p>
                    </div>
                </div>
                <div class="w-72 flex-shrink-0">
                     <div class="p-5 acrylic-sidebar-bg sidebar-right-style h-full shadow-lg">
                        <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-bold text-slate-700">å¥½å‹åˆ—è¡¨</h2><span class="px-2 py-0.5 bg-green-100 text-green-700 text-xs font-bold rounded-full">4 åœ¨çº¿</span></div>
                        <div class="space-y-3">
                            <div class="flex items-center gap-3 p-2 rounded-xl hover:bg-black/5 cursor-pointer"><div class="w-8 h-8 rounded-full bg-indigo-500"></div><div><div class="text-sm font-bold">KillerQueen</div><div class="text-xs text-green-600">åœ¨çº¿</div></div></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- VIEW: Home -->
            <div id="view-Home" class="view-section hidden space-y-8 max-w-6xl mx-auto">
                <div class="relative w-full h-80 rounded-3xl overflow-hidden shadow-2xl group cursor-pointer">
                    <div class="absolute inset-0 bg-gradient-to-r from-slate-900 to-slate-800"></div>
                    <div class="absolute inset-0 bg-gradient-to-r from-purple-900 via-blue-900 to-slate-900 opacity-80"></div>
                    <div class="absolute bottom-0 left-0 p-8 text-white max-w-2xl">
                        <div class="inline-block px-3 py-1 theme-bg rounded-full text-xs font-bold mb-3 uppercase tracking-wider">ä»Šæ—¥å¤´æ¡</div>
                        <h1 class="text-4xl font-bold mb-2">å¤å­£ç‰¹å–ç°å·²å¼€å¯</h1>
                        <p class="text-slate-200 text-lg mb-4">æ•°åƒæ¬¾æ¸¸æˆä½è‡³ä¸€æŠ˜ï¼Œæ›´æœ‰å…¨æ–°ç‚¹æ•°å•†åº—ç‰©å“ç­‰ä½ æ¥æ‹¿ã€‚</p>
                        <button class="px-6 py-2 bg-white text-slate-900 rounded-full font-bold hover:bg-blue-50 transition-colors">äº†è§£æ›´å¤š</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- AI Modal -->
    <div id="ai-modal" class="fixed inset-0 z-[100] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-black/30 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop"></div>
        <div class="relative w-full max-w-lg mx-4 transform scale-95 opacity-0 transition-all duration-300" id="modal-content">
            <div class="relative bg-white/80 backdrop-blur-xl border border-white/50 rounded-3xl shadow-2xl overflow-hidden">
                <div class="h-32 relative overflow-hidden bg-gradient-to-r from-blue-500 to-purple-600" id="modal-header-bg">
                    <button id="close-modal" class="absolute top-4 right-4 p-2 bg-black/20 hover:bg-black/30 rounded-full text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                    <div class="absolute bottom-6 left-8 text-white"><h2 id="modal-title" class="text-2xl font-bold">AI Insight</h2></div>
                </div>
                <div class="p-8">
                    <div id="ai-loading" class="flex flex-col items-center justify-center py-8"><div class="w-10 h-10 border-4 border-t-transparent rounded-full animate-spin theme-border"></div><p class="text-slate-500 text-sm mt-4">Thinking...</p></div>
                    <div id="ai-result" class="hidden"><p id="ai-text" class="text-slate-700 text-lg"></p><button id="close-modal-action" class="mt-6 w-full py-3 text-white rounded-xl font-medium theme-bg theme-hover">Got it</button></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic -->
    <script type="module">
        // ç§»é™¤å¤–éƒ¨ SDK å¼•ç”¨ï¼Œæ”¹ä¸ºç›´æ¥ fetch

        // --- 1. THEME & COLOR SYSTEM ---
        function hexToRgb(hex) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `${r}, ${g}, ${b}`;
        }

        function applyThemeColor(hex) {
            const root = document.documentElement;
            const rgb = hexToRgb(hex);
            root.style.setProperty('--primary-color', hex);
            root.style.setProperty('--primary-rgb', rgb);
            root.style.setProperty('--primary-light', `rgba(${rgb}, 0.1)`);
            root.style.setProperty('--primary-hover', hex); 
            
            document.getElementById('theme-color-picker').value = hex;
            const modalHeader = document.getElementById('modal-header-bg');
            if(modalHeader) modalHeader.style.background = `linear-gradient(to right, ${hex}, #a855f7)`;
        }

        function extractColorFromImage(imageSrc, callback) {
            const img = new Image();
            img.src = imageSrc;
            img.crossOrigin = "Anonymous";
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 1; canvas.height = 1;
                ctx.drawImage(img, 0, 0, 1, 1);
                const [r, g, b] = ctx.getImageData(0, 0, 1, 1).data;
                const hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
                callback(hex);
            };
            img.onerror = function() {
                console.log("Failed to extract color due to CORS or network error, skipping color update.");
            }
        }

        // --- 2. AI CONFIGURATION ---
        let aiConfig = {
            enabled: true,
            provider: 'gemini',
            apiKey: '',
            baseUrl: 'https://api.openai.com/v1',
            modelName: 'gemini-2.5-flash-preview-09-2025'
        };

        function loadAIConfig() {
            const saved = localStorage.getItem('steam_ai_config');
            if (saved) {
                aiConfig = JSON.parse(saved);
                if (aiConfig.provider === 'gemini' && aiConfig.modelName.includes('gemini-1.5')) {
                    aiConfig.modelName = 'gemini-2.5-flash-preview-09-2025';
                }
            }
            updateAIUI();
        }

        function saveAIConfig() {
            aiConfig.enabled = document.getElementById('ai-master-switch').checked;
            aiConfig.apiKey = document.getElementById('ai-api-key').value.trim();
            aiConfig.baseUrl = document.getElementById('ai-base-url').value.trim() || 'https://api.openai.com/v1';
            aiConfig.modelName = document.getElementById('ai-model-name').value.trim();
            localStorage.setItem('steam_ai_config', JSON.stringify(aiConfig));
            updateAIUI();
            
            // UI Feedback
            const btn = document.getElementById('save-ai-config-btn');
            btn.innerText = "å·²ä¿å­˜!";
            setTimeout(() => btn.innerText = "ä¿å­˜é…ç½®", 1500);
        }

        function updateAIUI() {
            const displayStyle = aiConfig.enabled ? 'block' : 'none';
            const detailDisplayStyle = aiConfig.enabled ? 'flex' : 'none';
            document.getElementById('sidebar-ai-section').style.display = displayStyle;
            document.getElementById('detail-ai-insight-btn').style.display = detailDisplayStyle;

            document.getElementById('ai-master-switch').checked = aiConfig.enabled;
            document.getElementById('ai-api-key').value = aiConfig.apiKey;
            document.getElementById('ai-base-url').value = aiConfig.baseUrl;
            document.getElementById('ai-model-name').value = aiConfig.modelName;

            document.querySelectorAll('.provider-option').forEach(el => {
                const isSelected = el.getAttribute('data-provider') === aiConfig.provider;
                if (isSelected) {
                    el.className = "provider-option p-4 rounded-xl border-2 theme-border theme-bg-light text-center cursor-pointer relative";
                } else {
                    el.className = "provider-option p-4 rounded-xl border border-slate-200 bg-white/50 text-center cursor-pointer relative";
                }
            });

            const baseUrlGroup = document.getElementById('ai-base-url-group');
            const apiKeyGroup = document.getElementById('ai-api-key-group');
            if (aiConfig.provider === 'openai') {
                baseUrlGroup.classList.remove('hidden');
                apiKeyGroup.classList.remove('hidden');
                if(!aiConfig.modelName) document.getElementById('ai-model-name').value = "gpt-3.5-turbo";
            } else if (aiConfig.provider === 'local') {
                baseUrlGroup.classList.remove('hidden');
                apiKeyGroup.classList.add('hidden');
                document.getElementById('ai-base-url').value = 'http://localhost:11434/v1';
                if(!aiConfig.modelName) document.getElementById('ai-model-name').value = "llama3";
            } else {
                baseUrlGroup.classList.add('hidden');
                apiKeyGroup.classList.remove('hidden');
                document.getElementById('ai-model-name').value = "gemini-2.5-flash-preview-09-2025";
            }
        }

        document.getElementById('ai-master-switch').addEventListener('change', (e) => {
            aiConfig.enabled = e.target.checked;
            saveAIConfig();
        });

        document.querySelectorAll('.provider-option').forEach(el => {
            el.addEventListener('click', () => {
                aiConfig.provider = el.getAttribute('data-provider');
                updateAIUI();
            });
        });
        document.getElementById('save-ai-config-btn').addEventListener('click', saveAIConfig);

        async function callAI(prompt) {
            if (!aiConfig.enabled) return "AI åŠŸèƒ½å·²ç¦ç”¨ã€‚";
            
            const keyToUse = (aiConfig.apiKey || "").trim();
            const modelToUse = (aiConfig.modelName || "").trim();

            // é’ˆå¯¹ Gemini å’Œ OpenAI çš„ Key æ£€æŸ¥
            if ((aiConfig.provider === 'gemini' || aiConfig.provider === 'openai') && !keyToUse) {
                switchTab('Settings');
                // å°è¯•å±•å¼€å¯¹åº”çš„è®¾ç½®é¡¹ (è™½ç„¶è¿™é‡Œæ²¡æœ‰æŠ˜å ï¼Œä½†é€»è¾‘ä¸Šå¯¼å‘æ­£ç¡®)
                document.querySelector('[data-target="settings-ai"]').click();
                return `è¯·å…ˆé…ç½® ${aiConfig.provider === 'gemini' ? 'Gemini' : 'OpenAI'} API Keyã€‚\n\nå·²ä¸ºæ‚¨è·³è½¬åˆ°è®¾ç½®é¡µé¢ï¼Œè¯·è¾“å…¥ Key åç‚¹å‡»ä¿å­˜ã€‚`;
            }

            try {
                if (aiConfig.provider === 'gemini') {
                    // ... existing gemini logic ...
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelToUse}:generateContent?key=${keyToUse}`;
                    
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }]
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(errorData.error?.message || `HTTP Error: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "æœªæ”¶åˆ° AI å›å¤";
                } else {
                    // OpenAI æˆ– Local é€»è¾‘
                    const apiKeyToUse = aiConfig.apiKey || (aiConfig.provider === 'local' ? 'sk-local' : '');
                    const response = await fetch(`${aiConfig.baseUrl}/chat/completions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiKeyToUse}` },
                        body: JSON.stringify({
                            model: modelToUse,
                            messages: [{ role: "user", content: prompt }]
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        const errorMsg = errorData.error?.message || `HTTP ${response.status} ${response.statusText}`;
                        throw new Error(`è¯·æ±‚å¤±è´¥: ${errorMsg}`);
                    }
                    const data = await response.json();
                    return data.choices[0].message.content;
                }
            } catch (error) {
                console.error(error);
                if (error.name === 'TypeError' && error.message.includes('NetworkError')) {
                     return "ç½‘ç»œè¿æ¥å¤±è´¥ï¼šè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè®¾ç½®ï¼ˆæˆ– VPN/ä»£ç†ï¼‰ã€‚\næµè§ˆå™¨æ— æ³•è¿æ¥åˆ° API æœåŠ¡å™¨ã€‚";
                }
                return `AI æœåŠ¡é”™è¯¯: ${error.message}`;
            }
        }

        // --- 3. BACKGROUND LOGIC ---
        const bgUpload = document.getElementById('bg-upload');
        const clearBgBtn = document.getElementById('clear-bg-btn');
        const autoThemeCheckbox = document.getElementById('auto-theme-color');
        const colorPicker = document.getElementById('theme-color-picker');
        const appBody = document.getElementById('app-body');
        const defaultBgBlobs = document.getElementById('default-bg-blobs');
        const blurSlider = document.getElementById('blur-slider');
        const blurValue = document.getElementById('blur-value');
        
        // NEW: Overlay Logic
        const overlaySlider = document.getElementById('overlay-slider');
        const overlayValue = document.getElementById('overlay-value');
        const bgOverlay = document.getElementById('bg-overlay');

        function loadSettings() {
            const savedBg = localStorage.getItem('steam_custom_bg');
            const savedColor = localStorage.getItem('steam_theme_color');
            const savedBlur = localStorage.getItem('steam_glass_blur');
            const savedOverlay = localStorage.getItem('steam_bg_overlay'); // Load opacity
            
            if (savedColor) applyThemeColor(savedColor);
            if (savedBg) applyBackground(savedBg, false);
            if (savedBlur) applyBlur(savedBlur);
            if (savedOverlay) applyOverlay(savedOverlay);
        }

        function applyBlur(val) {
            document.body.style.setProperty('--glass-blur', val + 'px');
            if(blurSlider) blurSlider.value = val;
            if(blurValue) blurValue.innerText = val;
        }

        // NEW: Apply Overlay Opacity
        function applyOverlay(val) {
            // Value is 0-90 (percent)
            const opacity = val / 100;
            if(bgOverlay) bgOverlay.style.backgroundColor = `rgba(0, 0, 0, ${opacity})`;
            if(overlaySlider) overlaySlider.value = val;
            if(overlayValue) overlayValue.innerText = val + '%';
        }

        function applyBackground(dataUrl, shouldExtract = true) {
            appBody.style.backgroundImage = `url(${dataUrl})`;
            appBody.classList.add('has-custom-bg');
            if(defaultBgBlobs) defaultBgBlobs.style.display = 'none';
            if (shouldExtract && autoThemeCheckbox.checked) {
                extractColorFromImage(dataUrl, (color) => {
                    applyThemeColor(color);
                    localStorage.setItem('steam_theme_color', color);
                });
            }
        }

        function removeBackground() {
            // 1. Remove background image
            appBody.style.backgroundImage = '';
            appBody.classList.remove('has-custom-bg');
            
            // 2. Ensure default blobs are visible (remove inline display style)
            if(defaultBgBlobs) defaultBgBlobs.style.display = ''; 
            
            // 3. Clear local storage for bg
            localStorage.removeItem('steam_custom_bg');
            
            // 4. RESET THEME COLOR to Default Blue
            applyThemeColor('#3b82f6');
            localStorage.setItem('steam_theme_color', '#3b82f6');
            
            // 5. RESET OVERLAY to 0
            applyOverlay(0);
            localStorage.setItem('steam_bg_overlay', '0');
            
            // 6. Reset Blur to default
            applyBlur(16);
            localStorage.setItem('steam_glass_blur', '16');

            // 7. Reset Checkbox UI
            if(autoThemeCheckbox) autoThemeCheckbox.checked = true;
        }

        bgUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (evt) => {
                    const dataUrl = evt.target.result;
                    applyBackground(dataUrl, true);
                    localStorage.setItem('steam_custom_bg', dataUrl);
                };
                reader.readAsDataURL(file);
            }
        });
        clearBgBtn.addEventListener('click', removeBackground);
        colorPicker.addEventListener('input', (e) => {
            applyThemeColor(e.target.value);
            localStorage.setItem('steam_theme_color', e.target.value);
            autoThemeCheckbox.checked = false;
        });
        autoThemeCheckbox.addEventListener('change', (e) => {
            if (e.target.checked) {
                const currentBg = localStorage.getItem('steam_custom_bg');
                if (currentBg) {
                    extractColorFromImage(currentBg, (color) => {
                        applyThemeColor(color);
                        localStorage.setItem('steam_theme_color', color);
                    });
                }
            }
        });
        
        // Listeners for sliders
        blurSlider.addEventListener('input', (e) => {
            applyBlur(e.target.value);
        });
        blurSlider.addEventListener('change', (e) => {
            localStorage.setItem('steam_glass_blur', e.target.value);
        });
        
        // NEW: Overlay Slider Listener
        overlaySlider.addEventListener('input', (e) => {
            applyOverlay(e.target.value);
        });
        overlaySlider.addEventListener('change', (e) => {
            localStorage.setItem('steam_bg_overlay', e.target.value);
        });

        // NEW: Preset Gallery Logic
        const presets = [
            { url: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=1080", thumb: "https://images.unsplash.com/photo-1451187580459-43490279c0fa?q=80&w=200" }, // Cyber/Tech
            { url: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=1080", thumb: "https://images.unsplash.com/photo-1477959858617-67f85cf4f1df?q=80&w=200" }, // City
            { url: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=1080", thumb: "https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=200" }, // Retro/Synthwave
            { url: "https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=1080", thumb: "https://images.unsplash.com/photo-1511512578047-dfb367046420?q=80&w=200" }  // Minimal/Game
        ];

        function renderPresets() {
            const container = document.getElementById('preset-bg-container');
            if(!container) return;
            container.innerHTML = presets.map(p => `
                <div class="aspect-video rounded-lg overflow-hidden cursor-pointer border-2 border-transparent hover:border-blue-500 transition-all shadow-sm group relative" onclick="applyPresetBg('${p.url}')">
                    <img src="${p.thumb}" class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" loading="lazy" />
                    <div class="absolute inset-0 bg-black/20 group-hover:opacity-0 transition-opacity"></div>
                </div>
            `).join('');
        }

        window.applyPresetBg = (url) => {
            applyBackground(url, true);
            localStorage.setItem('steam_custom_bg', url);
        }

        // --- 4. GAME & UI LOGIC ---
        const defaultGames = [
            { id: 1, title: "è‰¾å°”ç™»æ³•ç¯", color: "from-amber-900 via-yellow-700 to-amber-900", icon: "ring", hours: 128, lastPlayed: "æ˜¨å¤©", isRecent: true, isFav: true },
            { id: 2, title: "èµ›åšæœ‹å…‹ 2077", color: "from-yellow-400 via-yellow-300 to-yellow-500", icon: "cpu", hours: 64, lastPlayed: "3å¤©å‰", isRecent: true, isFav: false },
        ];

        const electronAPI = window.electronAPI || null;
        let allGames = [];
        let currentLibraryFilter = 'all';
        let isGridView = true;
        let currentGameForAI = null;

        const detailPrimaryBtn = document.querySelector('#view-GameDetail .flex.gap-4 button');
        if (detailPrimaryBtn) detailPrimaryBtn.id = 'detail-launch-btn';

        function getGameStyle(game) {
            if (game.coverUrl) return `background-image:url('${game.coverUrl}');background-size:cover;background-position:center;`;
            return '';
        }

        function renderSidebarGameList() {
             const listContainer = document.getElementById('sidebar-games');
             listContainer.innerHTML = allGames.slice(0, 8).map(game => `
                <div class="flex items-center gap-4 px-4 py-3 mx-2 rounded-r-full cursor-pointer transition-all duration-200 group text-slate-600 hover:bg-black/5" onclick="document.dispatchEvent(new CustomEvent('openGameDetail', {detail: ${game.id}}))">
                    <div class="transition-transform duration-200 group-hover:scale-110"><i data-lucide="gamepad-2" class="w-5 h-5"></i></div>
                    <span class="font-medium text-sm truncate">${game.title}</span>
                </div>
             `).join('');
             if(window.lucide) lucide.createIcons();
        }

        function renderLibraryGrid(filter, searchTerm = '') {
            const gridContainer = document.getElementById('view-Library');
            if (!gridContainer) return;

            let filteredGames = [];
            if (filter === 'all') filteredGames = allGames;
            else if (filter === 'recent') filteredGames = allGames.filter(g => g.isRecent);
            else if (filter === 'favorites') filteredGames = allGames.filter(g => g.isFav);

            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filteredGames = filteredGames.filter(g => g.title.toLowerCase().includes(term));
            }

            if (filteredGames.length === 0) {
                gridContainer.innerHTML = `<div class="col-span-full flex flex-col items-center justify-center py-20 text-slate-400"><i data-lucide="ghost" class="w-16 h-16 mb-4 opacity-50"></i><p class="text-lg">æ²¡æœ‰æ‰¾åˆ°æ¸¸æˆï¼Œç‚¹å‡»å³ä¸‹è§’ + æ·»åŠ æ¸¸æˆ</p></div>`;
                gridContainer.style.gridTemplateColumns = '1fr';
                if(window.lucide) lucide.createIcons();
                return;
            }

            if (isGridView) {
                gridContainer.style.gridTemplateColumns = 'repeat(auto-fill, minmax(240px, 1fr))';
                gridContainer.className = "view-section grid gap-8 pb-20";
                gridContainer.innerHTML = filteredGames.map((game) => `
                <div class="game-card group relative w-full aspect-[3/4] rounded-3xl transition-all duration-500 hover:-translate-y-2 hover:shadow-2xl cursor-pointer" onclick="document.dispatchEvent(new CustomEvent('openGameDetail', {detail: ${game.id}}))">
                    <div class="absolute inset-0 rounded-3xl overflow-hidden bg-white/40 backdrop-blur-md shadow-md border border-white/20">
                        <div class="absolute inset-0 bg-gradient-to-br ${game.color || 'from-slate-700 to-slate-900'} opacity-80 transition-transform duration-700 group-hover:scale-110" style="${getGameStyle(game)}"></div>
                        <div class="absolute top-6 left-0 w-full text-center px-4"><h3 class="text-white font-bold text-2xl drop-shadow-md">${game.title}</h3></div>
                        <button class="absolute top-3 right-3 z-30 p-2 rounded-full transition-all duration-200 ${game.isFav ? 'text-yellow-400 opacity-100' : 'text-white opacity-0 group-hover:opacity-100 hover:bg-black/20'}" onclick="event.stopPropagation(); window.toggleFavorite(${game.id});"><i data-lucide="star" class="w-5 h-5 ${game.isFav ? 'fill-current' : ''}"></i></button>
                        <div class="absolute bottom-0 left-0 right-0 h-20 bg-gradient-to-t from-black/60 to-transparent flex items-end justify-between p-4 z-20">
                            <div class="text-white/80 text-xs font-bold uppercase tracking-wider mb-2">${game.hours || 0}H</div>
                            <button class="w-10 h-10 rounded-full bg-white text-slate-900 flex items-center justify-center shadow-lg hover:scale-110 transition-transform" onclick="event.stopPropagation(); window.launchGame(${game.id});"><i data-lucide="play" class="w-4 h-4 fill-current"></i></button>
                        </div>
                    </div>
                </div>`).join('');
            } else {
                gridContainer.style.gridTemplateColumns = '1fr';
                gridContainer.className = "view-section flex flex-col gap-2 pb-20";
                gridContainer.innerHTML = filteredGames.map((game) => `
                <div class="list-row flex items-center justify-between p-4 bg-white/60 backdrop-blur-md rounded-xl cursor-pointer border border-white/50" onclick="document.dispatchEvent(new CustomEvent('openGameDetail', {detail: ${game.id}}))">
                    <div class="flex items-center gap-4">
                        <div class="w-12 h-12 rounded-lg bg-gradient-to-br ${game.color || 'from-slate-700 to-slate-900'} shadow-sm flex items-center justify-center text-white overflow-hidden" style="${getGameStyle(game)}">${game.coverUrl ? '' : `<i data-lucide="${game.icon || 'gamepad-2'}" class="w-6 h-6"></i>`}</div>
                        <div class="flex items-center gap-2">
                            <button class="p-1 rounded-full transition-colors ${game.isFav ? 'text-yellow-500' : 'text-slate-300 hover:text-yellow-400'}" onclick="event.stopPropagation(); window.toggleFavorite(${game.id});"><i data-lucide="star" class="w-4 h-4 ${game.isFav ? 'fill-current' : ''}"></i></button>
                            <div><div class="font-bold text-slate-800">${game.title}</div><div class="text-xs text-slate-500">ä¸Šæ¬¡è¿è¡Œ: ${game.lastPlayed || 'æœªè¿è¡Œ'}</div></div>
                        </div>
                    </div>
                    <div class="flex items-center gap-4">
                        <button class="p-2 bg-blue-50/50 text-blue-600 rounded-full hover:bg-blue-100 hover:scale-110 transition-all border border-blue-100" onclick="event.stopPropagation(); window.launchGame(${game.id});"><i data-lucide="play" class="w-5 h-5 fill-current"></i></button>
                    </div>
                </div>`).join('');
            }
            if(window.lucide) lucide.createIcons();
        }

        function refreshLibrary() {
            renderSidebarGameList();
            renderLibraryGrid(currentLibraryFilter, document.getElementById('global-search').value);
        }

        function parseArgsInput(value = '') {
            return value.split(' ').map(s => s.trim()).filter(Boolean);
        }

        window.toggleFavorite = async (id) => {
            const game = allGames.find(g => g.id === id);
            if (!game) return;
            game.isFav = !game.isFav;
            if (electronAPI) await electronAPI.updateGame(id, { isFav: game.isFav });
            refreshLibrary();
            if (currentGameForAI && currentGameForAI.id === id) updateDetailFavButton(game);
        };

        window.launchGame = async (id) => {
            const game = allGames.find(g => g.id === id);
            if (!game) return;
            if (!electronAPI) {
                alert('å½“å‰è¿è¡Œç¯å¢ƒä¸æ˜¯ Electronï¼Œæ— æ³•å¯åŠ¨æœ¬åœ°æ¸¸æˆã€‚');
                return;
            }
            const result = await electronAPI.launchGame(id);
            if (!result.ok) alert(`å¯åŠ¨å¤±è´¥: ${result.error}`);
            else {
                game.lastPlayed = 'åˆšåˆš';
                game.isRecent = true;
                refreshLibrary();
            }
        };

        function updateDetailFavButton(game) {
            const btn = document.getElementById('detail-fav-btn');
            if (!btn) return;
            if (game.isFav) {
                btn.className = "p-4 bg-yellow-400 text-white rounded-2xl hover:brightness-110 transition-all";
                btn.innerHTML = `<i data-lucide="star" class="w-6 h-6 fill-current"></i>`;
            } else {
                btn.className = "p-4 bg-white/10 backdrop-blur-md text-white border border-white/20 rounded-2xl hover:bg-white/20 transition-all";
                btn.innerHTML = `<i data-lucide="star" class="w-6 h-6"></i>`;
            }
            if(window.lucide) lucide.createIcons();
        }

        window.toggleDetailFavorite = () => {
            if (currentGameForAI) window.toggleFavorite(currentGameForAI.id);
        };

        function ensureGameFormModal() {
            if (document.getElementById('game-form-modal')) return;
            const modal = document.createElement('div');
            modal.id = 'game-form-modal';
            modal.className = 'hidden fixed inset-0 z-[90]';
            modal.innerHTML = `
                <div id="game-form-backdrop" class="absolute inset-0 bg-black/50"></div>
                <div class="absolute inset-0 flex items-center justify-center p-4">
                    <div class="w-full max-w-xl glass-panel p-6 bg-white/90">
                        <div class="flex items-center justify-between mb-4">
                            <h3 id="game-form-title" class="text-xl font-bold text-slate-800">æ·»åŠ æ¸¸æˆ</h3>
                            <button id="game-form-close" class="p-2 rounded-full hover:bg-black/5"><i data-lucide="x" class="w-5 h-5"></i></button>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <label class="text-sm text-slate-600">æ¸¸æˆåç§°</label>
                                <input id="game-name-input" class="w-full mt-1 px-3 py-2 rounded-lg border border-slate-200" placeholder="ä¾‹å¦‚ï¼šé»‘ç¥è¯ï¼šæ‚Ÿç©º" />
                            </div>
                            <div>
                                <label class="text-sm text-slate-600">å¯åŠ¨è·¯å¾„ï¼ˆå¿«æ·æ–¹å¼æˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</label>
                                <div class="flex gap-2 mt-1">
                                    <input id="game-exec-input" class="flex-1 px-3 py-2 rounded-lg border border-slate-200" placeholder="D:/Games/game.exe" />
                                    <button id="pick-exec-btn" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm">é€‰æ‹©</button>
                                </div>
                            </div>
                            <div>
                                <label class="text-sm text-slate-600">å¯åŠ¨å‚æ•°ï¼ˆå¯é€‰ï¼‰</label>
                                <input id="game-args-input" class="w-full mt-1 px-3 py-2 rounded-lg border border-slate-200" placeholder="--fullscreen --lang=zh" />
                            </div>
                            <div>
                                <label class="text-sm text-slate-600">å°é¢åœ°å€ï¼ˆå¯é€‰ï¼‰</label>
                                <div class="flex gap-2 mt-1">
                                    <input id="game-cover-input" class="flex-1 px-3 py-2 rounded-lg border border-slate-200" placeholder="https://.../cover.jpg æˆ–æœ¬åœ°å›¾ç‰‡" />
                                    <button id="fetch-cover-btn" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm">è‡ªåŠ¨</button>
                                    <button id="pick-cover-btn" class="px-3 py-2 rounded-lg bg-slate-100 hover:bg-slate-200 text-sm">æœ¬åœ°</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end gap-2">
                            <button id="game-form-cancel" class="px-4 py-2 rounded-lg bg-slate-100 hover:bg-slate-200">å–æ¶ˆ</button>
                            <button id="game-form-save" class="px-4 py-2 rounded-lg text-white theme-bg theme-hover">ä¿å­˜</button>
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            const close = () => modal.classList.add('hidden');
            document.getElementById('game-form-close').onclick = close;
            document.getElementById('game-form-cancel').onclick = close;
            document.getElementById('game-form-backdrop').onclick = close;
            if(window.lucide) lucide.createIcons();
        }

        async function openGameForm(mode, game = null) {
            ensureGameFormModal();
            const modal = document.getElementById('game-form-modal');
            const titleInput = document.getElementById('game-name-input');
            const execInput = document.getElementById('game-exec-input');
            const argsInput = document.getElementById('game-args-input');
            const coverInput = document.getElementById('game-cover-input');
            document.getElementById('game-form-title').innerText = mode === 'add' ? 'æ·»åŠ æ¸¸æˆ' : 'ç¼–è¾‘æ¸¸æˆè®¾ç½®';
            titleInput.value = game?.title || '';
            execInput.value = game?.execPath || '';
            argsInput.value = Array.isArray(game?.args) ? game.args.join(' ') : (game?.args || '');
            coverInput.value = game?.coverUrl || '';
            modal.classList.remove('hidden');

            document.getElementById('pick-exec-btn').onclick = async () => {
                if (!electronAPI) return;
                const p = await electronAPI.pickExecutable();
                if (p) execInput.value = p;
            };
            document.getElementById('pick-cover-btn').onclick = async () => {
                if (!electronAPI?.pickCoverFile) return;
                const p = await electronAPI.pickCoverFile();
                if (p) coverInput.value = p;
            };
            document.getElementById('fetch-cover-btn').onclick = async () => {
                const name = titleInput.value.trim();
                if (!name || !electronAPI) return;
                coverInput.value = await electronAPI.fetchCover(name);
            };

            document.getElementById('game-form-save').onclick = async () => {
                const payload = {
                    title: titleInput.value.trim(),
                    execPath: execInput.value.trim(),
                    args: parseArgsInput(argsInput.value),
                    coverUrl: coverInput.value.trim(),
                };
                if (!payload.title) return alert('è¯·å¡«å†™æ¸¸æˆåç§°');
                if (!payload.execPath) return alert('è¯·å¡«å†™å¯åŠ¨è·¯å¾„');

                if (electronAPI) {
                    if (mode === 'add') {
                        const result = await electronAPI.addGame(payload);
                        if (Array.isArray(result)) {
                            allGames = result;
                        } else {
                            if (!result?.ok) {
                                alert(result?.error || 'æ·»åŠ å¤±è´¥');
                                return;
                            }
                            allGames = await electronAPI.getGames();
                        }
                    } else {
                        await electronAPI.updateGame(game.id, payload);
                        allGames = await electronAPI.getGames();
                    }
                } else {
                    if (mode === 'add') {
                        allGames.push({ id: Date.now(), ...payload, isFav: false, isRecent: false, hours: 0, lastPlayed: 'æœªè¿è¡Œ', color: 'from-slate-700 via-slate-600 to-slate-900' });
                    } else {
                        allGames = allGames.map(g => g.id === game.id ? { ...g, ...payload } : g);
                    }
                }

                modal.classList.add('hidden');
                refreshLibrary();
                if (mode === 'edit') {
                    currentGameForAI = allGames.find(g => g.id === game.id) || null;
                    if (currentGameForAI) document.dispatchEvent(new CustomEvent('openGameDetail', { detail: currentGameForAI.id }));
                }
            };
        }

        async function quickAddGame() {
            await openGameForm('add');
        }

        async function editCurrentGame() {
            if (!currentGameForAI) return;
            await openGameForm('edit', currentGameForAI);
        }

        async function removeCurrentGame() {
            if (!currentGameForAI) return;
            if (!confirm(`ç¡®å®šåˆ é™¤ã€Œ${currentGameForAI.title}ã€å—ï¼Ÿ`)) return;
            if (electronAPI) {
                await electronAPI.removeGame(currentGameForAI.id);
                allGames = await electronAPI.getGames();
            } else {
                allGames = allGames.filter(g => g.id !== currentGameForAI.id);
            }
            document.getElementById('back-to-library').click();
            refreshLibrary();
        }

        async function initGames() {
            if (electronAPI) {
                allGames = await electronAPI.getGames();
            }
            if (!allGames.length) allGames = [...defaultGames];
            refreshLibrary();

            const addBtn = document.createElement('button');
            addBtn.id = 'quick-add-game-btn';
            addBtn.title = 'æ·»åŠ æ¸¸æˆ';
            addBtn.className = 'fixed right-8 bottom-8 z-50 w-14 h-14 rounded-full text-white shadow-xl hover:scale-110 transition-all theme-bg theme-hover';
            addBtn.innerHTML = '<i data-lucide="plus" class="w-6 h-6 mx-auto"></i>';
            addBtn.onclick = quickAddGame;
            document.body.appendChild(addBtn);

            const actionRow = document.querySelector('#view-GameDetail .flex.gap-4');

            const settingsBtn = document.createElement('button');
            settingsBtn.id = 'detail-settings-btn';
            settingsBtn.title = 'æ¸¸æˆè®¾ç½®';
            settingsBtn.className = 'p-4 bg-white/10 backdrop-blur-md text-white border border-white/20 rounded-2xl hover:bg-white/20 transition-all';
            settingsBtn.innerHTML = '<i data-lucide="settings" class="w-6 h-6"></i>';
            settingsBtn.onclick = editCurrentGame;
            actionRow?.appendChild(settingsBtn);

            const removeBtn = document.createElement('button');
            removeBtn.id = 'detail-remove-btn';
            removeBtn.title = 'åˆ é™¤æ¸¸æˆ';
            removeBtn.className = 'p-4 bg-red-500/80 text-white rounded-2xl hover:bg-red-500 transition-all';
            removeBtn.innerHTML = '<i data-lucide="trash-2" class="w-6 h-6"></i>';
            removeBtn.onclick = removeCurrentGame;
            actionRow?.appendChild(removeBtn);

            document.getElementById('detail-launch-btn')?.addEventListener('click', () => {
                if (currentGameForAI) window.launchGame(currentGameForAI.id);
            });

            if(window.lucide) lucide.createIcons();
        }


// --- NAVIGATION & TABS ---
        const tabs = document.querySelectorAll('.tab-btn');
        const views = document.querySelectorAll('.view-section');
        const sidebar = document.getElementById('main-sidebar');
        const viewToggleBtn = document.getElementById('view-toggle-btn');

        function switchTab(target) {
            tabs.forEach(t => {
                t.classList.remove('active-tab');
                if(t.dataset.tab === target) t.classList.add('active-tab');
            });
            views.forEach(v => v.classList.add('hidden'));
            document.getElementById(`view-${target}`).classList.remove('hidden');
            
            // Sidebar Logic
            if(target === 'Library') {
                sidebar.classList.remove('hidden');
                sidebar.classList.add('md:flex');
                if(viewToggleBtn) {
                    viewToggleBtn.classList.add('fade-visible');
                    viewToggleBtn.classList.remove('fade-hidden');
                }
            } else {
                sidebar.classList.add('hidden');
                sidebar.classList.remove('md:flex');
                if(viewToggleBtn) {
                    viewToggleBtn.classList.remove('fade-visible');
                    viewToggleBtn.classList.add('fade-hidden');
                }
            }
        }

        tabs.forEach(t => t.addEventListener('click', () => switchTab(t.dataset.tab)));
        document.getElementById('header-logo').addEventListener('click', () => switchTab('Home'));
        document.getElementById('user-avatar-btn').addEventListener('click', () => switchTab('Settings'));
        // Menu toggle logic removed as button is removed
        
        // Search & Filter
        document.getElementById('global-search').addEventListener('input', (e) => {
            renderLibraryGrid(currentLibraryFilter, e.target.value);
            if (document.querySelector('.active-tab').dataset.tab !== 'Library') switchTab('Library');
        });

        document.querySelectorAll('.sidebar-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active-item'));
                item.classList.add('active-item');
                currentLibraryFilter = item.dataset.filter;
                renderLibraryGrid(currentLibraryFilter);
                switchTab('Library');
            });
        });

        // View Toggle
        viewToggleBtn.addEventListener('click', () => {
            isGridView = !isGridView;
            const icon = document.getElementById('view-icon');
            icon.setAttribute('data-lucide', isGridView ? 'grid' : 'list');
            renderLibraryGrid(currentLibraryFilter, document.getElementById('global-search').value);
        });

        // Settings Sub-nav
        const settingBtns = document.querySelectorAll('.settings-nav-btn');
        const settingPanels = document.querySelectorAll('.settings-content-panel');
        settingBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                settingBtns.forEach(b => {
                    b.classList.remove('theme-bg-light', 'theme-text', 'font-semibold');
                    b.classList.add('text-slate-600', 'hover:bg-black/5');
                });
                btn.classList.remove('text-slate-600', 'hover:bg-black/5');
                btn.classList.add('theme-bg-light', 'theme-text', 'font-semibold');
                
                settingPanels.forEach(p => p.classList.add('hidden'));
                document.getElementById(btn.dataset.target).classList.remove('hidden');
            });
        });

        // Detail View Logic
        document.addEventListener('openGameDetail', (e) => {
            const g = allGames.find(game => game.id === e.detail);
            if(g) {
                currentGameForAI = g;
                document.getElementById('detail-logo').innerText = g.title;
                document.getElementById('detail-hours').innerText = `${g.hours} å°æ—¶`;
                document.getElementById('detail-last-played').innerText = `ä¸Šæ¬¡: ${g.lastPlayed}`;
                const hero = document.getElementById('detail-hero-bg');
                hero.className = `absolute inset-0 bg-gradient-to-br ${g.color || 'from-slate-700 to-slate-900'} transition-colors duration-700`;
                hero.style.backgroundImage = g.coverUrl ? `url(${g.coverUrl})` : '';
                hero.style.backgroundSize = g.coverUrl ? 'cover' : '';
                hero.style.backgroundPosition = g.coverUrl ? 'center' : '';
                
                updateDetailFavButton(g);
                document.getElementById('view-Library').classList.add('hidden');
                document.getElementById('view-GameDetail').classList.remove('hidden');
                sidebar.classList.add('hidden');
                sidebar.classList.remove('md:flex');
                if(viewToggleBtn) {
                    viewToggleBtn.classList.remove('fade-visible');
                    viewToggleBtn.classList.add('fade-hidden');
                }
            }
        });

        document.getElementById('back-to-library').addEventListener('click', () => {
            document.getElementById('view-GameDetail').classList.add('hidden');
            document.getElementById('view-Library').classList.remove('hidden');
            sidebar.classList.remove('hidden');
            sidebar.classList.add('md:flex');
            if(viewToggleBtn) {
                viewToggleBtn.classList.add('fade-visible');
                viewToggleBtn.classList.remove('fade-hidden');
            }
            currentGameForAI = null;
        });

        // AI Logic & Modal
        const modal = document.getElementById('ai-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalContent = document.getElementById('modal-content');
        
        function openModal() {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalContent.classList.remove('opacity-0', 'scale-95');
                modalContent.classList.add('opacity-100', 'scale-100');
            }, 10);
        }
        function closeModal() {
            modalBackdrop.classList.add('opacity-0');
            modalContent.classList.remove('opacity-100', 'scale-100');
            modalContent.classList.add('opacity-0', 'scale-95');
            setTimeout(() => modal.classList.add('hidden'), 300);
        }
        document.getElementById('close-modal').addEventListener('click', closeModal);
        document.getElementById('close-modal-action').addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);

        document.getElementById('detail-ai-insight-btn').addEventListener('click', async () => {
            if(!currentGameForAI) return;
            openModal();
            document.getElementById('ai-text').innerText = "æ­£åœ¨åˆ†ææˆ˜æœ¯...";
            const res = await callAI(`è¯·åˆ†æã€Š${currentGameForAI.title}ã€‹çš„æ ¸å¿ƒä¹è¶£ï¼Œé£æ ¼å¹½é»˜ã€‚`);
            document.getElementById('ai-text').innerText = res;
        });

        document.getElementById('ai-pick-btn').addEventListener('click', async () => {
            openModal();
            document.getElementById('ai-text').innerText = "AI æ­£åœ¨æŒ‘é€‰...";
            const titles = allGames.map(g=>g.title).join(",");
            const res = await callAI(`ä»è¿™äº›æ¸¸æˆä¸­é€‰ä¸€ä¸ªé€‚åˆç°åœ¨ç©çš„: ${titles}ã€‚è¿”å›æ¸¸æˆåå’Œç†ç”±ã€‚`);
            document.getElementById('ai-text').innerText = res;
        });

        // Init
        loadAIConfig();
        loadSettings();
        initGames();
        renderPresets();
        if(window.lucide) lucide.createIcons();

    </script>
</body>
</html>